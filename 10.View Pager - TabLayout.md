# View Pager - TabLayout

Tài liệu này hướng dẫn từng bước về ViewPager2 và TabLayout cho người mới bắt đầu: khái niệm, cách tạo adapter, cách quản lý fragment, cách gắn tab, và cách tùy biến giao diện.

---

## 1. What’s ViewPager2?

**ViewPager2** là phiên bản nâng cấp của ViewPager cũ, cho phép người dùng **vuốt ngang** giữa nhiều màn hình (page). Mỗi page thường là một `Fragment`.

### Ưu điểm của ViewPager2
- Dựa trên `RecyclerView` nên hiệu năng tốt hơn.
- Hỗ trợ **vertical paging** (vuốt dọc).
- Dễ tích hợp với `TabLayout`.
- Hỗ trợ `DiffUtil`, `ListAdapter`.

### Khi nào dùng?
- Khi có nhiều màn hình nhỏ liên quan nhau và muốn chuyển nhanh bằng vuốt.
- Kết hợp với TabLayout để điều hướng theo tab.

---

## 2. FragmentStateAdapter

Đây là adapter chuẩn cho ViewPager2. Nó quản lý việc tạo và hủy `Fragment` khi người dùng chuyển trang.

### Cấu trúc cơ bản
```kotlin
class MainPagerAdapter(
    fragmentActivity: FragmentActivity
) : FragmentStateAdapter(fragmentActivity) {

    private val fragments = listOf(
        HomeFragment(),
        ProfileFragment(),
        SettingsFragment()
    )

    override fun getItemCount(): Int = fragments.size

    override fun createFragment(position: Int): Fragment = fragments[position]
}
```

### Lưu ý
- ViewPager2 giữ lại một số fragment gần trang hiện tại để chuyển mượt.
- Fragment bị hủy khi không còn trong phạm vi cần thiết.

---

## 3. Fragment Transaction in ViewPager

Khi ViewPager2 chuyển trang, nó **không dùng FragmentTransaction trực tiếp** như `replace()` hay `add()` trong `FragmentManager`. Thay vào đó:

1. ViewPager2 gọi adapter để **tạo fragment mới** khi cần.
2. FragmentManager tự động thêm fragment vào đúng vị trí.
3. Fragment không còn cần sẽ được lưu trạng thái và hủy.

### Một số hành vi cần biết
- `onCreateView()` sẽ được gọi khi fragment hiển thị lần đầu.
- `onDestroyView()` có thể được gọi khi fragment bị đưa ra khỏi bộ nhớ.
- Dữ liệu nên lưu vào `ViewModel` để tránh mất khi fragment bị hủy.

### Nếu muốn giữ fragment không bị hủy
```kotlin
viewPager.offscreenPageLimit = 3
```
Lưu ý: giữ nhiều fragment sẽ tốn bộ nhớ.

---

## 4. Tab Layout with ViewPager

TabLayout thường được dùng để hiển thị tiêu đề và cho phép người dùng nhấn để đổi page.

### Bước 1: Thêm dependency
```gradle
implementation("com.google.android.material:material:<latest_version>")
```

### Bước 2: Layout XML
```xml
<com.google.android.material.tabs.TabLayout
    android:id="@+id/tabLayout"
    android:layout_width="match_parent"
    android:layout_height="wrap_content" />

<androidx.viewpager2.widget.ViewPager2
    android:id="@+id/viewPager"
    android:layout_width="match_parent"
    android:layout_height="0dp"
    android:layout_weight="1" />
```

### Bước 3: Gắn Adapter và TabLayoutMediator
```kotlin
class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val viewPager = findViewById<ViewPager2>(R.id.viewPager)
        val tabLayout = findViewById<TabLayout>(R.id.tabLayout)

        val adapter = MainPagerAdapter(this)
        viewPager.adapter = adapter

        val tabTitles = listOf("Home", "Profile", "Settings")

        TabLayoutMediator(tabLayout, viewPager) { tab, position ->
            tab.text = tabTitles[position]
        }.attach()
    }
}
```

### Giải thích
- `TabLayoutMediator` là cầu nối giữa TabLayout và ViewPager2.
- `attach()` bắt buộc để bắt đầu đồng bộ.

---

## 5. Customizing Tab Layout

Bạn có thể tùy biến giao diện tab để phù hợp với thiết kế ứng dụng.

### 5.1 Đổi màu chữ và indicator
```xml
<com.google.android.material.tabs.TabLayout
    android:id="@+id/tabLayout"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    app:tabIndicatorColor="@color/teal_700"
    app:tabSelectedTextColor="@color/teal_700"
    app:tabTextColor="@color/gray" />
```

### 5.2 Thêm icon cho tab
```kotlin
val tabIcons = listOf(
    R.drawable.ic_home,
    R.drawable.ic_profile,
    R.drawable.ic_settings
)

TabLayoutMediator(tabLayout, viewPager) { tab, position ->
    tab.text = tabTitles[position]
    tab.setIcon(tabIcons[position])
}.attach()
```

### 5.3 Tab layout custom (tùy biến toàn bộ)
```kotlin
TabLayoutMediator(tabLayout, viewPager) { tab, position ->
    val customView = layoutInflater.inflate(R.layout.item_tab, null)
    val titleView = customView.findViewById<TextView>(R.id.tabTitle)
    titleView.text = tabTitles[position]
    tab.customView = customView
}.attach()
```

Ví dụ `item_tab.xml`:
```xml
<TextView
    android:id="@+id/tabTitle"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:textSize="14sp"
    android:textStyle="bold"
    android:textColor="@color/black" />
```

---

## Ví dụ thực tế trong project

Project hiện đã có ví dụ ViewPager2 + TabLayout với nội dung rõ ràng cho người mới:

- `app/src/main/java/com/didan/android/viewpagertablayout/MainActivity.kt`: Tạo danh sách page, gắn adapter và TabLayoutMediator.
- `app/src/main/java/com/didan/android/viewpagertablayout/MyPagerAdapter.kt`: Adapter kế thừa `FragmentStateAdapter`.
- `app/src/main/java/com/didan/android/viewpagertablayout/SimplePageFragment.kt`: Fragment nhận dữ liệu qua `Bundle` và hiển thị title/description/image.
- `app/src/main/res/layout/fragment_page.xml`: Layout cho từng trang (ảnh + tiêu đề + mô tả).

Bạn có thể mở các file này để xem đầy đủ luồng từ tạo dữ liệu, khởi tạo adapter đến hiển thị nội dung trên từng tab.

---

## Gợi ý thực hành
- Tạo 3 fragment đơn giản và hiển thị text khác nhau.
- Thêm icon cho tab và đổi màu tab khi được chọn.
- Thử `offscreenPageLimit` để thấy sự khác biệt về lifecycle.

---

## Tổng kết

ViewPager2 kết hợp với TabLayout là cách rất phổ biến để tạo giao diện đa trang.
Với `FragmentStateAdapter` và `TabLayoutMediator`, bạn có thể triển khai nhanh, dễ mở rộng và dễ tùy biến.
