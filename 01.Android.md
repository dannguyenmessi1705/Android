# Giới thiệu Android và ứng dụng CurrencyConvertApp

Tài liệu này trình bày tổng quan về Android, cấu trúc thư mục của project, giải thích Views trong Android, và phân tích chi tiết ví dụ code từ app CurrencyConvertApp trong project này.

## 1) Giới thiệu về Android (dành cho người mới)

Android là hệ điều hành di động mã nguồn mở do Google phát triển, chạy trên nhiều thiết bị như điện thoại, máy tính bảng, TV, đồng hồ thông minh. Lập trình Android thường dùng:
- Ngôn ngữ: Kotlin (khuyến nghị), Java.
- Giao diện: XML layout (View system truyền thống) hoặc Jetpack Compose (UI hiện đại).
- Công cụ: Android Studio, Gradle để build và quản lý thư viện.

Kiến trúc Android (đơn giản hóa):
- **Linux Kernel**: quản lý tiến trình, bộ nhớ, mạng, driver thiết bị.
- **HAL (Hardware Abstraction Layer)**: lớp trung gian giúp framework giao tiếp với phần cứng.
- **Android Runtime (ART)**: chạy app, gồm core libraries.
- **Application Framework**: cung cấp các API cho app (Activity Manager, Window Manager, Resource Manager,...).
- **Applications**: các ứng dụng người dùng.

Thành phần chính trong ứng dụng Android:
- **Activity**: màn hình giao diện. Mỗi activity giống như một "trang".
- **Fragment**: phần nhỏ trong giao diện, tái sử dụng.
- **Service**: chạy ngầm (phát nhạc, đồng bộ dữ liệu).
- **BroadcastReceiver**: lắng nghe sự kiện hệ thống.
- **ContentProvider**: chia sẻ dữ liệu giữa các app.

Trong project này, ứng dụng đơn giản dùng 1 Activity (MainActivity) và layout XML.

## 2) Cấu trúc thư mục Project Android

### 2.1 Tổng quan về cấu trúc Project

Khi tạo một project Android mới trong Android Studio, hệ thống sẽ tự động tạo ra một cấu trúc thư mục tiêu chuẩn. Hiểu rõ cấu trúc này là bước đầu tiên quan trọng để phát triển ứng dụng Android hiệu quả.

**Có hai chế độ xem trong Android Studio:**
- **Android View** (mặc định): Hiển thị cấu trúc đơn giản hóa, dễ làm việc.
- **Project View**: Hiển thị cấu trúc thực sự trên ổ đĩa.

### 2.2 Cấu trúc thư mục tổng quan

```
MyAndroidProject/
├── .gradle/                    # Cache của Gradle (tự động tạo)
├── .idea/                      # Cấu hình Android Studio (tự động tạo)
├── app/                        # Module chính của ứng dụng
│   ├── build/                  # Thư mục output sau khi build (tự động tạo)
│   ├── libs/                   # Thư viện JAR bên ngoài (nếu có)
│   ├── src/                    # Source code và tài nguyên
│   │   ├── main/               # Code và resource chính
│   │   │   ├── java/           # Code Kotlin/Java
│   │   │   ├── res/            # Tài nguyên (layout, images, strings,...)
│   │   │   └── AndroidManifest.xml
│   │   ├── androidTest/        # Instrumented tests (chạy trên thiết bị/emulator)
│   │   └── test/               # Unit tests (chạy trên JVM)
│   ├── build.gradle.kts        # Cấu hình build cho module app
│   └── proguard-rules.pro      # Rules cho ProGuard (code obfuscation)
├── gradle/                     # Gradle wrapper
│   ├── libs.versions.toml      # Version catalog cho dependencies
│   └── wrapper/
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── build.gradle.kts            # Cấu hình build cấp project (root)
├── gradle.properties           # Cấu hình properties cho Gradle
├── gradlew                     # Gradle wrapper script (Linux/Mac)
├── gradlew.bat                 # Gradle wrapper script (Windows)
├── local.properties            # Đường dẫn SDK local (không commit lên git)
└── settings.gradle.kts         # Khai báo các module trong project
```

### 2.3 Chi tiết các thành phần quan trọng

#### 2.3.1 Thư mục `app/` (Module chính)

Đây là module chính chứa toàn bộ code và tài nguyên của ứng dụng.

**Cấu trúc chi tiết:**
```
app/
├── src/
│   └── main/
│       ├── java/com/example/myapp/    # Package chứa code Kotlin/Java
│       │   ├── MainActivity.kt        # Activity chính
│       │   ├── ui/                    # Thư mục chứa UI components
│       │   ├── data/                  # Thư mục chứa data layer
│       │   └── utils/                 # Thư mục chứa utilities
│       ├── res/                       # Tài nguyên
│       └── AndroidManifest.xml        # Manifest file
├── build.gradle.kts                   # Build config của module
└── proguard-rules.pro                 # ProGuard rules
```

#### 2.3.2 Thư mục `res/` (Resources)

Thư mục `res/` chứa tất cả tài nguyên không phải code của ứng dụng:

```
res/
├── drawable/               # Hình ảnh, shapes, selectors (không phụ thuộc density)
├── drawable-hdpi/          # Hình ảnh cho high-density screens
├── drawable-mdpi/          # Hình ảnh cho medium-density screens
├── drawable-xhdpi/         # Hình ảnh cho extra-high-density screens
├── drawable-xxhdpi/        # Hình ảnh cho extra-extra-high-density screens
├── drawable-xxxhdpi/       # Hình ảnh cho extra-extra-extra-high-density screens
├── layout/                 # Layout XML cho giao diện
├── layout-land/            # Layout cho chế độ landscape (ngang)
├── layout-sw600dp/         # Layout cho tablet (smallest width >= 600dp)
├── mipmap-hdpi/            # App icon cho high-density
├── mipmap-mdpi/            # App icon cho medium-density
├── mipmap-xhdpi/           # App icon cho extra-high-density
├── mipmap-xxhdpi/          # App icon cho extra-extra-high-density
├── mipmap-xxxhdpi/         # App icon cho extra-extra-extra-high-density
├── mipmap-anydpi-v26/      # Adaptive icon (Android 8.0+)
├── values/                 # Giá trị (strings, colors, dimensions, styles)
│   ├── colors.xml          # Định nghĩa màu sắc
│   ├── strings.xml         # Định nghĩa chuỗi văn bản
│   ├── dimens.xml          # Định nghĩa kích thước
│   ├── themes.xml          # Định nghĩa themes
│   └── styles.xml          # Định nghĩa styles
├── values-night/           # Giá trị cho Dark mode
├── values-vi/              # Chuỗi tiếng Việt (localization)
├── values-en/              # Chuỗi tiếng Anh
├── xml/                    # Các file XML khác (backup rules, network config,...)
├── raw/                    # File raw (audio, video, json,...)
├── font/                   # Custom fonts
├── anim/                   # Animation XML
├── animator/               # Property animation XML
├── menu/                   # Menu XML
└── navigation/             # Navigation graph XML
```

**Quy ước đặt tên file trong `res/`:**
- Chỉ dùng chữ thường, số và dấu gạch dưới.
- Không bắt đầu bằng số.
- Ví dụ: `activity_main.xml`, `ic_launcher.png`, `background_gradient.xml`

#### 2.3.3 File `AndroidManifest.xml`

File manifest khai báo thông tin thiết yếu về ứng dụng cho hệ thống Android:

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- Khai báo quyền ứng dụng cần -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.CAMERA" />

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.MyApp">

        <!-- Khai báo Activity -->
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="@string/app_name">
            <!-- Intent filter cho launcher -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <!-- Khai báo các Activity khác -->
        <activity android:name=".SecondActivity" />

        <!-- Khai báo Service -->
        <service android:name=".MyService" />

        <!-- Khai báo BroadcastReceiver -->
        <receiver android:name=".MyReceiver" />

        <!-- Khai báo ContentProvider -->
        <provider
            android:name=".MyProvider"
            android:authorities="com.example.myapp.provider" />

    </application>
</manifest>
```

**Các thành phần chính trong Manifest:**

| Thành phần | Mô tả |
|------------|-------|
| `<manifest>` | Root element, chứa package name |
| `<uses-permission>` | Khai báo quyền cần thiết |
| `<uses-feature>` | Khai báo tính năng hardware cần thiết |
| `<application>` | Cấu hình ứng dụng (icon, theme, backup,...) |
| `<activity>` | Khai báo Activity |
| `<service>` | Khai báo Service |
| `<receiver>` | Khai báo BroadcastReceiver |
| `<provider>` | Khai báo ContentProvider |
| `<intent-filter>` | Khai báo Intent mà component xử lý |

#### 2.3.4 File `build.gradle.kts` (Module level - app)

File cấu hình build cho module app:

```kotlin
plugins {
    alias(libs.plugins.android.application)  // Plugin Android application
    alias(libs.plugins.kotlin.android)       // Plugin Kotlin
}

android {
    namespace = "com.example.myapp"          // Package name
    compileSdk = 34                          // SDK version để compile

    defaultConfig {
        applicationId = "com.example.myapp"  // ID duy nhất của app trên Play Store
        minSdk = 24                          // SDK tối thiểu để chạy app
        targetSdk = 34                       // SDK mục tiêu
        versionCode = 1                      // Version code (số nguyên, tăng mỗi lần release)
        versionName = "1.0"                  // Version name (hiển thị cho user)

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            isMinifyEnabled = false          // Bật/tắt ProGuard
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
        debug {
            isDebuggable = true              // Cho phép debug
        }
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = "1.8"
    }

    buildFeatures {
        viewBinding = true                   // Bật ViewBinding
        // dataBinding = true                // Bật DataBinding (nếu cần)
        // compose = true                    // Bật Jetpack Compose (nếu cần)
    }
}

dependencies {
    // AndroidX Core
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.appcompat)
    implementation(libs.material)
    implementation(libs.androidx.activity)
    implementation(libs.androidx.constraintlayout)

    // Testing
    testImplementation(libs.junit)
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
}
```

#### 2.3.5 File `build.gradle.kts` (Project level - root)

File cấu hình build cấp project:

```kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.kotlin.android) apply false
}
```

#### 2.3.6 File `settings.gradle.kts`

Khai báo các module trong project:

```kotlin
pluginManagement {
    repositories {
        google {
            content {
                includeGroupByRegex("com\\.android.*")
                includeGroupByRegex("com\\.google.*")
                includeGroupByRegex("androidx.*")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}

dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = "MyApp"
include(":app")                    // Khai báo module app
// include(":library")             // Thêm module khác nếu có
```

#### 2.3.7 File `gradle/libs.versions.toml` (Version Catalog)

Quản lý version của dependencies tập trung:

```toml
[versions]
agp = "8.2.0"
kotlin = "1.9.0"
coreKtx = "1.12.0"
junit = "4.13.2"
junitVersion = "1.1.5"
espressoCore = "3.5.1"
appcompat = "1.6.1"
material = "1.11.0"
activity = "1.8.0"
constraintlayout = "2.1.4"

[libraries]
androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
junit = { group = "junit", name = "junit", version.ref = "junit" }
androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "junitVersion" }
androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espressoCore" }
androidx-appcompat = { group = "androidx.appcompat", name = "appcompat", version.ref = "appcompat" }
material = { group = "com.google.android.material", name = "material", version.ref = "material" }
androidx-activity = { group = "androidx.activity", name = "activity", version.ref = "activity" }
androidx-constraintlayout = { group = "androidx.constraintlayout", name = "constraintlayout", version.ref = "constraintlayout" }

[plugins]
android-application = { id = "com.android.application", version.ref = "agp" }
kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }
```

### 2.4 Các file quan trọng khác

| File | Mô tả |
|------|-------|
| `gradle.properties` | Cấu hình JVM, AndroidX, Kotlin code style |
| `local.properties` | Đường dẫn Android SDK (không commit lên git) |
| `gradlew` / `gradlew.bat` | Script để chạy Gradle mà không cần cài Gradle |
| `proguard-rules.pro` | Rules cho code shrinking và obfuscation |
| `.gitignore` | Các file/thư mục không commit lên git |

### 2.5 Quy trình Build Android

```
Source Code + Resources
        ↓
    Compile (javac/kotlinc)
        ↓
    .class files
        ↓
    DEX (Dalvik Executable)
        ↓
    APK/AAB Packaging
        ↓
    Sign (debug/release key)
        ↓
    Final APK/AAB
```

**Các loại build:**
- **Debug build**: Để phát triển và test, tự động sign bằng debug key.
- **Release build**: Để publish, cần sign bằng release key.

### 2.6 Cấu trúc thư mục Project CurrencyConvertApp

Áp dụng vào project hiện tại:

```
CurrencyConvertApp/
├── app/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/didan/android/currencyconvertapp/
│   │   │   │   └── MainActivity.kt      # Activity chính
│   │   │   ├── res/
│   │   │   │   ├── layout/
│   │   │   │   │   └── activity_main.xml # Layout cho MainActivity
│   │   │   │   ├── values/
│   │   │   │   │   ├── strings.xml       # Chuỗi văn bản
│   │   │   │   │   ├── colors.xml        # Màu sắc
│   │   │   │   │   └── themes.xml        # Theme ứng dụng
│   │   │   │   ├── drawable/
│   │   │   │   │   └── background.jpg    # Ảnh nền
│   │   │   │   └── mipmap-*/             # App icons
│   │   │   └── AndroidManifest.xml
│   │   ├── androidTest/                  # Instrumented tests
│   │   └── test/                         # Unit tests
│   ├── build.gradle.kts
│   └── proguard-rules.pro
├── gradle/
│   ├── libs.versions.toml
│   └── wrapper/
├── build.gradle.kts
├── settings.gradle.kts
├── gradle.properties
├── gradlew
├── gradlew.bat
├── local.properties
└── Android.md                            # Tài liệu này
```

## 3) Giao diện CurrencyConvertApp (activity_main.xml)

File layout: `app/src/main/res/layout/activity_main.xml`

```xml
<androidx.constraintlayout.widget.ConstraintLayout
    android:id="@+id/main"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@drawable/background">

    <TextView
        android:id="@+id/textView"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/currency_converter_app"
        android:textColor="@color/white"
        android:textSize="28sp"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <EditText
        android:id="@+id/editText"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:hint="@string/enter_usd"
        android:inputType="number"
        android:textColor="@color/white"
        android:textColorHint="@color/white"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/textView" />

    <Button
        android:id="@+id/converterBTN"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/convert_to_euro"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/editText" />

    <TextView
        android:id="@+id/resultText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="@string/_0_euros"
        android:textColor="@color/white"
        android:textSize="64sp"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintBottom_toBottomOf="parent" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

Giải thích nhanh:
- **ConstraintLayout**: ViewGroup cho phép căn lề (constraint) giữa các View và parent.
- **TextView (title)**: hiển thị tiêu đề "Currency Converter App".
- **EditText**: người dùng nhập số USD; `inputType="number"` giới hạn chỉ nhập số.
- **Button**: nút bấm để chuyển đổi.
- **TextView (result)**: hiển thị kết quả, mặc định "0 Euros".
- **Background**: sử dụng `@drawable/background` (ảnh `background.jpg`).

## 4) Code Kotlin (MainActivity)

File: `app/src/main/java/com/didan/android/currencyconvertapp/MainActivity.kt`

```kotlin
class MainActivity : AppCompatActivity() {

    lateinit var titleTextView: TextView
    lateinit var resultTextView: TextView
    lateinit var editText: EditText
    lateinit var converterButton: Button

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        enableEdgeToEdge()
        setContentView(R.layout.activity_main)

        titleTextView = findViewById(R.id.textView)
        resultTextView = findViewById(R.id.resultText)
        editText = findViewById(R.id.editText)
        converterButton = findViewById(R.id.converterBTN)

        converterButton.setOnClickListener {
            val enteredUSD = editText.text.toString()
            val enteredUSDDouble = enteredUSD.toDouble()
            val euros = makeConversion(enteredUSDDouble)
            resultTextView.text = "$euros Euros"
        }
    }

    fun makeConversion(usd: Double): Double {
        return usd * 0.94
    }
}
```

Phân tích:
- **setContentView(R.layout.activity_main)**: nạp layout XML.
- **findViewById**: liên kết View trong XML với biến Kotlin.
- **setOnClickListener**: xử lý sự kiện bấm nút.
- **makeConversion**: tính toán tỉ giá USD -> EUR (tỉ lệ 0.94).

## 5) Luồng hoạt động của ứng dụng

1. App khởi động, `MainActivity` được tạo.
2. Layout `activity_main.xml` được inflate.
3. Người dùng nhập số USD vào `EditText`.
4. Bấm nút "Convert to Euro".
5. App lấy giá trị, chuyển sang Double, nhân 0.94.
6. Hiển thị kết quả trên `resultText`.

## 6) Tài nguyên string (strings.xml)

File: `app/src/main/res/values/strings.xml`

```xml
<resources>
    <string name="app_name">CurrencyConvertApp</string>
    <string name="currency_converter_app">Currency Converter App</string>
    <string name="enter_usd">Enter USD</string>
    <string name="convert_to_euro">Convert to Euro</string>
    <string name="_0_euros">0 Euros</string>
</resources>
```

Lợi ích:
- Dễ dàng dịch đa ngôn ngữ.
- Tránh hardcode chuỗi trong code.

## 7) Gợi ý cho người mới (để hiểu và mở rộng)

- Nếu `EditText` rỗng, `toDouble()` sẽ gây lỗi. Có thể dùng:
  - `enteredUSD.toDoubleOrNull()` và xử lý nếu null.
- Có thể thêm định dạng số:
  - `String.format(Locale.US, "%.2f Euros", euros)`.
- Mở rộng app: cho phép chọn tỉ giá, đổi từ EUR -> USD, hoặc cập nhật tỉ giá từ API.
- Khi UI phức tạp hơn, nên dùng **ViewBinding** hoặc **DataBinding** thay vì `findViewById`.

## 8) Tóm tắt nhanh cho người mới

- **Android** là hệ điều hành di động, app được viết bằng Kotlin/Java, giao diện có thể khai báo XML.
- **Project** có `app/` là module chính, `res/` chứa tài nguyên UI, `AndroidManifest.xml` khai báo app.
- **View** là thành phần giao diện; **ViewGroup** là layout chứa các View con.
- App CurrencyConvertApp có 1 màn hình: nhập USD, bấm nút, hiển thị Euro.

## 9) Hình ảnh minh họa UI (thêm screenshot vào Android.md)

Đặt ảnh minh họa UI vào một thư mục trong project (ví dụ: `docs/ui-screenshot.png`), sau đó nhúng vào file Markdown:

```md
![Giao diện CurrencyConvertApp](docs/ui-screenshot.png)
```

### Cách chụp màn hình trên Emulator (Android Studio)
- Mở App trên Emulator.
- Dùng nút **Take Screenshot** trong Android Studio hoặc thanh công cụ của Emulator.
- Lưu file vào `docs/ui-screenshot.png` để link Markdown hoạt động.

### Cách chụp màn hình trên thiết bị thật (ADB)
1. Bật **Developer options** và **USB debugging** trên điện thoại.
2. Kết nối điện thoại với máy tính, kiểm tra:
   - `adb devices`
3. Chụp màn hình và tải về máy:
   - `adb shell screencap -p /sdcard/currency_app.png`
   - `adb pull /sdcard/currency_app.png docs/ui-screenshot.png`

Sau khi có ảnh, mở `Android.md` và kiểm tra link ảnh có hiển thị đúng không.

## 10) Hướng dẫn build và chạy ứng dụng

### 10.1 Chạy bằng Android Studio (dễ nhất cho người mới)
1. Mở Android Studio -> **Open** -> chọn thư mục project `CurrencyConvertApp`.
2. Chờ Gradle sync hoàn tất.
3. Chọn thiết bị (Emulator hoặc điện thoại thật).
4. Bấm nút **Run** (hình tam giác xanh).

### 10.2 Chạy bằng dòng lệnh (Gradle + ADB)
Điều kiện: Đã cài Android SDK và ADB.

Build APK debug:
```
./gradlew assembleDebug
```

Cài lên thiết bị/emulator:
```
./gradlew installDebug
```

Kiểm tra thiết bị đang kết nối:
```
adb devices
```

Gỡ bỏ app (nếu cần):
```
adb uninstall com.didan.android.currencyconvertapp
```

### 10.3 Mẹo xử lý lỗi thường gặp
- **Gradle sync fail**: kiểm tra lại `local.properties` có đường dẫn SDK chính xác.
- **Không thấy thiết bị**: kiểm tra cáp USB, driver, và bật USB debugging.
- **App crash khi nhập rỗng**: cần xử lý `toDoubleOrNull()` như gợi ý ở mục 8.
