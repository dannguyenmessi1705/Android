# 09. Navigation Drawer

Tài liệu này hướng dẫn từng bước để tạo Navigation Drawer trong Android bằng Kotlin. Mục tiêu là giúp người mới bắt đầu hiểu cấu trúc, cách tổ chức layout, menu, fragment và luồng chuyển đổi giữa các màn hình.

---

## 1. Creating Layouts

Navigation Drawer thường bắt đầu bằng `DrawerLayout` làm root, bên trong gồm:
- Vùng nội dung chính (thường là `FrameLayout`) để chứa Fragment.
- `NavigationView` hiển thị menu trượt từ cạnh trái.
- (Tùy chọn) `Toolbar` nằm trong `AppBarLayout`.

Ví dụ `activity_main.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.drawerlayout.widget.DrawerLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:id="@+id/drawer_layout"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <!-- Nội dung chính -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical">

        <androidx.appcompat.widget.Toolbar
            android:id="@+id/toolbar"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:background="?attr/colorPrimary"
            android:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar"
            app:popupTheme="@style/ThemeOverlay.AppCompat.Light" />

        <FrameLayout
            android:id="@+id/fragment_container"
            android:layout_width="match_parent"
            android:layout_height="0dp"
            android:layout_weight="1" />
    </LinearLayout>

    <!-- Navigation Drawer -->
    <com.google.android.material.navigation.NavigationView
        android:id="@+id/navigation_view"
        android:layout_width="wrap_content"
        android:layout_height="match_parent"
        android:layout_gravity="start"
        app:headerLayout="@layout/nav_header"
        app:menu="@menu/nav_menu" />

</androidx.drawerlayout.widget.DrawerLayout>
```

**Lưu ý:**
- `headerLayout` là layout phần đầu (logo, avatar...).
- `menu` là file XML định nghĩa các mục trong Navigation Drawer.
- Nếu theme dùng `NoActionBar` mà bạn không tự thêm `Toolbar` trong layout và gọi `setSupportActionBar`, thì sẽ không thấy thanh trên cùng (và nút mở Drawer).

---

## 2. Creating Menu

Tạo file `res/menu/nav_menu.xml` để khai báo các mục menu:

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android">
    <group android:checkableBehavior="single">
        <item
            android:id="@+id/nav_home"
            android:icon="@drawable/ic_home"
            android:title="Home" />

        <item
            android:id="@+id/nav_message"
            android:icon="@drawable/ic_message"
            android:title="Message" />

        <item
            android:id="@+id/nav_settings"
            android:icon="@drawable/ic_settings"
            android:title="Settings" />

        <item
            android:id="@+id/nav_login"
            android:icon="@drawable/ic_login"
            android:title="Login" />
    </group>
</menu>
```

**Giải thích:**
- `group` giúp chỉ chọn một item tại một thời điểm (`single`).
- Mỗi `item` tương ứng với một Fragment.

---

## 3. Creating Fragments

Mỗi mục menu sẽ mở một Fragment. Các bước cơ bản:
1. Tạo layout XML cho Fragment (ví dụ: `fragment_home.xml`).
2. Tạo class Fragment trong Kotlin (ví dụ: `HomeFragment.kt`).

Ví dụ `fragment_home.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:gravity="center"
    android:orientation="vertical">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Home Fragment"
        android:textSize="20sp" />
</LinearLayout>
```

Ví dụ `HomeFragment.kt`:

```kotlin
class HomeFragment : Fragment(R.layout.fragment_home)
```

Làm tương tự cho các Fragment khác (Message, Settings, Login...).

---

## 4. Fragments' Transaction

Fragment Transaction là quá trình thay thế Fragment trong `FrameLayout` bằng Fragment khác.

Ví dụ hàm trong `MainActivity.kt`:

```kotlin
private fun openFragment(fragment: Fragment, title: String) {
    supportFragmentManager.beginTransaction()
        .replace(R.id.fragment_container, fragment)
        .commit()
    supportActionBar?.title = title
}
```

Đặt Fragment mặc định khi app mở:

```kotlin
if (savedInstanceState == null) {
    openFragment(HomeFragment(), "Home")
}
```

**Lưu ý:**
- `replace()` sẽ thay thế Fragment cũ.
- Dùng `addToBackStack(null)` nếu muốn quay lại Fragment trước bằng nút Back.

---

## 5. Navigation Drawer

Bước cuối cùng là kết nối menu với Fragment và hiển thị Drawer.

### 5.1. Tạo `ActionBarDrawerToggle`

```kotlin
val drawerLayout = findViewById<DrawerLayout>(R.id.drawer_layout)
val navigationView = findViewById<NavigationView>(R.id.navigation_view)
val toolbar = findViewById<Toolbar>(R.id.toolbar)

setSupportActionBar(toolbar)

val toggle = ActionBarDrawerToggle(
    this,
    drawerLayout,
    toolbar,
    R.string.drawer_open,
    R.string.drawer_close
)
drawerLayout.addDrawerListener(toggle)
toggle.syncState()
```

### 5.2. Bắt sự kiện click menu

```kotlin
navigationView.setNavigationItemSelectedListener { menuItem ->
    when (menuItem.itemId) {
        R.id.nav_home -> openFragment(HomeFragment(), "Home")
        R.id.nav_message -> openFragment(MessageFragment(), "Message")
        R.id.nav_settings -> openFragment(SettingsFragment(), "Settings")
        R.id.nav_login -> openFragment(LoginFragment(), "Login")
    }
    drawerLayout.closeDrawers()
    true
}
```

### 5.3. Xử lý nút Back

Nếu Drawer đang mở thì ưu tiên đóng Drawer:

```kotlin
override fun onBackPressed() {
    if (drawerLayout.isDrawerOpen(GravityCompat.START)) {
        drawerLayout.closeDrawer(GravityCompat.START)
    } else {
        super.onBackPressed()
    }
}
```

---

## Tổng kết

Bạn đã hoàn thành Navigation Drawer với các bước:
- Tạo `DrawerLayout` và `NavigationView`.
- Tạo menu và Fragment tương ứng.
- Thực hiện Fragment Transaction để chuyển màn hình.
- Kết nối menu với Drawer và Toolbar.

Từ đây, bạn có thể tùy biến thêm icon, header, hoặc thêm hiệu ứng chuyển Fragment để ứng dụng sinh động hơn.
