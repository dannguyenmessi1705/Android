## 1) Views trong Android

### 1.1 Views và ViewGroups

#### 1.1.1 View là gì?

**View** là thành phần cơ bản nhất của giao diện người dùng (UI) trong Android. Mọi thứ bạn nhìn thấy trên màn hình đều là View hoặc được tạo từ View.

**Đặc điểm của View:**
- Chiếm một vùng hình chữ nhật trên màn hình.
- Có thể vẽ nội dung (text, image, shape,...).
- Có thể xử lý sự kiện (click, touch, scroll,...).
- Là lớp cơ sở cho tất cả UI components.

**Các View phổ biến:**

| View | Mô tả | Ví dụ sử dụng |
|------|-------|---------------|
| `TextView` | Hiển thị văn bản | Label, tiêu đề, nội dung |
| `EditText` | Nhập văn bản | Form input, search box |
| `Button` | Nút bấm | Submit, cancel, action |
| `ImageView` | Hiển thị hình ảnh | Avatar, icon, banner |
| `ImageButton` | Nút bấm có hình ảnh | Icon button |
| `CheckBox` | Hộp kiểm | Chọn nhiều options |
| `RadioButton` | Nút radio | Chọn một trong nhiều |
| `Switch` | Công tắc bật/tắt | Settings on/off |
| `ProgressBar` | Thanh tiến trình | Loading indicator |
| `SeekBar` | Thanh kéo | Volume, brightness |
| `Spinner` | Dropdown menu | Chọn từ danh sách |
| `WebView` | Hiển thị web | Trang web trong app |
| `RecyclerView` | Danh sách cuộn | List, grid của items |
| `ScrollView` | Cuộn nội dung | Nội dung dài hơn màn hình |

#### 1.1.2 ViewGroup là gì?

**ViewGroup** là View đặc biệt có khả năng chứa các View con khác. ViewGroup định nghĩa cách các View con được sắp xếp và hiển thị.

**Đặc điểm của ViewGroup:**
- Kế thừa từ lớp View.
- Có thể chứa nhiều View con (children).
- Quản lý layout (vị trí, kích thước) của các View con.
- Có thể lồng nhau (ViewGroup chứa ViewGroup khác).

**Các ViewGroup phổ biến:**

| ViewGroup | Mô tả |
|-----------|-------|
| `LinearLayout` | Sắp xếp View theo hàng ngang hoặc dọc |
| `RelativeLayout` | Sắp xếp View tương đối với nhau |
| `ConstraintLayout` | Sắp xếp View theo ràng buộc (constraint) |
| `FrameLayout` | Xếp chồng View lên nhau |
| `CoordinatorLayout` | Hỗ trợ animation và behavior |
| `ScrollView` | Cuộn một View con theo chiều dọc |
| `HorizontalScrollView` | Cuộn theo chiều ngang |
| `NestedScrollView` | ScrollView hỗ trợ nested scrolling |
| `RecyclerView` | Danh sách tối ưu hiệu năng |
| `CardView` | Container với shadow và corner radius |

#### 1.1.3 View Hierarchy (Cây phân cấp View)

Giao diện Android được tổ chức theo cấu trúc cây:

```
ViewGroup (Root - thường là Layout)
├── View (TextView)
├── View (Button)
├── ViewGroup (LinearLayout)
│   ├── View (ImageView)
│   └── View (TextView)
└── View (EditText)
```

**Ví dụ thực tế:**
```xml
<ConstraintLayout>                    <!-- Root ViewGroup -->
    <TextView />                      <!-- View con 1 -->
    <EditText />                      <!-- View con 2 -->
    <LinearLayout>                    <!-- ViewGroup con -->
        <Button />                    <!-- View cháu 1 -->
        <Button />                    <!-- View cháu 2 -->
    </LinearLayout>
    <ImageView />                     <!-- View con 3 -->
</ConstraintLayout>
```

**Lưu ý về hiệu năng:**
- Cây View càng sâu (nhiều lồng nhau) thì hiệu năng càng giảm.
- Android phải đo lường (measure) và vẽ (draw) từng View.
- Nên giữ hierarchy phẳng, sử dụng ConstraintLayout thay vì lồng nhiều Layout.

### 1.2 Chỉnh sửa UI trong Android Studio (UI Editing in Android Studio)

Android Studio cung cấp nhiều công cụ mạnh mẽ để thiết kế giao diện.

#### 1.2.1 Mở Layout Editor

1. Mở file layout XML trong `res/layout/` (ví dụ: `activity_main.xml`).
2. Android Studio tự động hiển thị Layout Editor.
3. Có thể chuyển đổi giữa các chế độ xem bằng các tab ở góc trên.

#### 1.2.2 Các thành phần của Layout Editor

```
┌─────────────────────────────────────────────────────────────────┐
│  [Palette]  │        [Design/Blueprint View]        │[Attributes]│
│             │                                       │            │
│  Common     │   ┌─────────────────────────────┐    │ id         │
│  - TextView │   │                             │    │ layout_w   │
│  - Button   │   │      Preview của           │    │ layout_h   │
│  - ImageView│   │      giao diện             │    │ text       │
│  Text       │   │                             │    │ textSize   │
│  - EditText │   │                             │    │ ...        │
│  Buttons    │   └─────────────────────────────┘    │            │
│  Widgets    │                                       │            │
│  Layouts    │   [Component Tree]                    │            │
│  Containers │   └─ ConstraintLayout                │            │
│  Helpers    │      ├─ TextView                     │            │
│             │      ├─ EditText                     │            │
│             │      └─ Button                       │            │
└─────────────────────────────────────────────────────────────────┘
```

**Các phần chính:**

| Thành phần | Mô tả |
|------------|-------|
| **Palette** | Danh sách các View/ViewGroup có thể kéo thả vào layout |
| **Design View** | Xem trước giao diện như khi chạy app |
| **Blueprint View** | Xem cấu trúc và constraint (không có styling) |
| **Component Tree** | Cây phân cấp các View trong layout |
| **Attributes** | Chỉnh sửa thuộc tính của View được chọn |
| **Toolbar** | Các công cụ: device preview, orientation, API level,... |

#### 1.2.3 Cách thêm View vào Layout

**Cách 1: Kéo thả từ Palette**
1. Chọn View trong Palette (ví dụ: Button).
2. Kéo vào Design View hoặc Component Tree.
3. Thả vào vị trí mong muốn.

**Cách 2: Viết trực tiếp XML**
1. Chuyển sang tab "Code" hoặc "Split".
2. Thêm tag XML cho View mới.
3. Android Studio sẽ tự động cập nhật preview.

**Cách 3: Sử dụng Code Completion**
1. Trong XML, gõ `<` và tên View.
2. Android Studio gợi ý các View phù hợp.
3. Chọn và nhấn Enter để thêm.

#### 1.2.4 Chỉnh sửa thuộc tính View

**Qua Attributes Panel:**
1. Chọn View trong Design View hoặc Component Tree.
2. Tìm thuộc tính cần sửa trong Attributes panel.
3. Nhập giá trị mới.

**Qua XML trực tiếp:**
```xml
<TextView
    android:id="@+id/myTextView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textSize="18sp"
    android:textColor="#000000" />
```

### 1.3 Các chế độ của Layout Editor (Layout Editor Modes)

Android Studio cung cấp 3 chế độ làm việc với layout:

#### 1.3.1 Code Mode

Chỉ hiển thị XML code, không có preview.

**Khi nào sử dụng:**
- Chỉnh sửa nhanh XML.
- Máy tính cấu hình thấp, preview chậm.
- Cần copy/paste code.

**Shortcut:** Click tab "Code" hoặc nhấn `Ctrl+Shift+Right Arrow`

#### 1.3.2 Split Mode (Chế độ chia đôi)

Hiển thị cả XML code và preview cạnh nhau.

**Khi nào sử dụng:**
- Vừa viết code vừa xem kết quả.
- Debug layout issues.
- Học và hiểu XML layout.

**Shortcut:** Click tab "Split"

#### 1.3.3 Design Mode

Chỉ hiển thị visual editor, không có XML.

**Khi nào sử dụng:**
- Thiết kế nhanh bằng drag & drop.
- Tạo prototype.
- Người mới bắt đầu.

**Shortcut:** Click tab "Design" hoặc nhấn `Ctrl+Shift+Left Arrow`

#### 1.3.4 Design View vs Blueprint View

Trong Design Mode và Split Mode, có thể chọn hiển thị:

| Chế độ | Mô tả | Icon |
|--------|-------|------|
| **Design** | Hiển thị giao diện như khi chạy app | Hình điện thoại |
| **Blueprint** | Hiển thị cấu trúc, constraint, không có styling | Hình blueprint |
| **Design + Blueprint** | Hiển thị cả hai cạnh nhau | Cả hai icon |

**Blueprint hữu ích khi:**
- Xem và chỉnh sửa constraint trong ConstraintLayout.
- Debug vấn đề về layout.
- Làm việc với View có background trong suốt.

#### 1.3.5 Toolbar của Layout Editor

```
[Device] [Orientation] [API] [Theme] [Language] | [Eye] [Constraint] [Guideline] | [Refresh]
```

| Công cụ | Mô tả |
|---------|-------|
| **Device** | Chọn thiết bị preview (Pixel, tablet, custom,...) |
| **Orientation** | Xoay portrait/landscape |
| **API Level** | Chọn Android version để preview |
| **Theme** | Chọn theme (Light, Dark, custom) |
| **Language** | Chọn ngôn ngữ để preview localization |
| **Eye icon** | Hiện/ẩn các thành phần UI (system bars, notch,...) |
| **Constraint** | Bật/tắt hiển thị constraint |
| **Guideline** | Thêm guideline cho ConstraintLayout |
| **Refresh** | Làm mới preview |

### 1.4 Các thuộc tính của View (Views' Attributes)

#### 1.4.1 Thuộc tính cơ bản (Common Attributes)

Mọi View đều có các thuộc tính sau:

**ID - Định danh View:**
```xml
android:id="@+id/myView"
```
- `@+id/` tạo ID mới trong file `R.java`.
- `@id/` tham chiếu đến ID đã tồn tại.
- ID dùng để truy cập View từ code và tạo constraint.

**Kích thước (Width & Height):**
```xml
android:layout_width="..."
android:layout_height="..."
```

| Giá trị | Mô tả |
|---------|-------|
| `match_parent` | Chiếm toàn bộ không gian của parent |
| `wrap_content` | Vừa đủ với nội dung |
| `100dp` | Kích thước cố định (dp = density-independent pixels) |
| `0dp` | Trong ConstraintLayout, kích thước theo constraint |

**Visibility - Hiển thị:**
```xml
android:visibility="visible"    <!-- Hiển thị (mặc định) -->
android:visibility="invisible"  <!-- Ẩn nhưng vẫn chiếm không gian -->
android:visibility="gone"       <!-- Ẩn và không chiếm không gian -->
```

**Background - Nền:**
```xml
android:background="#FF5722"              <!-- Màu hex -->
android:background="@color/primary"       <!-- Màu từ resource -->
android:background="@drawable/bg_shape"   <!-- Drawable resource -->
```

**Padding - Khoảng cách bên trong:**
```xml
android:padding="16dp"              <!-- Tất cả các cạnh -->
android:paddingStart="8dp"          <!-- Bên trái (LTR) / phải (RTL) -->
android:paddingEnd="8dp"            <!-- Bên phải (LTR) / trái (RTL) -->
android:paddingTop="8dp"            <!-- Phía trên -->
android:paddingBottom="8dp"         <!-- Phía dưới -->
android:paddingHorizontal="16dp"    <!-- Trái và phải -->
android:paddingVertical="8dp"       <!-- Trên và dưới -->
```

**Margin - Khoảng cách bên ngoài:**
```xml
android:layout_margin="16dp"
android:layout_marginStart="8dp"
android:layout_marginEnd="8dp"
android:layout_marginTop="8dp"
android:layout_marginBottom="8dp"
android:layout_marginHorizontal="16dp"
android:layout_marginVertical="8dp"
```

**Minh họa Padding vs Margin:**
```
┌──────────────────────────────────┐
│          MARGIN                  │
│   ┌──────────────────────────┐   │
│   │      BORDER              │   │
│   │   ┌──────────────────┐   │   │
│   │   │    PADDING       │   │   │
│   │   │   ┌──────────┐   │   │   │
│   │   │   │ CONTENT  │   │   │   │
│   │   │   └──────────┘   │   │   │
│   │   └──────────────────┘   │   │
│   └──────────────────────────┘   │
└──────────────────────────────────┘
```

#### 1.4.2 Thuộc tính cho TextView

```xml
<TextView
    android:id="@+id/myTextView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textSize="16sp"
    android:textColor="#333333"
    android:textStyle="bold|italic"
    android:textAlignment="center"
    android:fontFamily="sans-serif-medium"
    android:lineSpacingExtra="4dp"
    android:maxLines="2"
    android:ellipsize="end"
    android:drawableStart="@drawable/ic_icon"
    android:drawablePadding="8dp" />
```

| Thuộc tính | Mô tả |
|------------|-------|
| `text` | Nội dung văn bản |
| `textSize` | Cỡ chữ (sp = scale-independent pixels) |
| `textColor` | Màu chữ |
| `textStyle` | Kiểu chữ: normal, bold, italic |
| `textAlignment` | Căn lề: center, textStart, textEnd |
| `fontFamily` | Font chữ |
| `lineSpacingExtra` | Khoảng cách giữa các dòng |
| `maxLines` | Số dòng tối đa |
| `ellipsize` | Cách cắt text khi quá dài: end, start, middle, marquee |
| `drawableStart/End/Top/Bottom` | Icon kèm theo text |
| `drawablePadding` | Khoảng cách giữa icon và text |

#### 1.4.3 Đơn vị đo lường trong Android

| Đơn vị | Tên đầy đủ | Mô tả | Sử dụng cho |
|--------|------------|-------|-------------|
| `dp` | Density-independent Pixels | Tự động scale theo mật độ màn hình | Kích thước, margin, padding |
| `sp` | Scale-independent Pixels | Như dp nhưng còn scale theo cài đặt font size của user | Text size |
| `px` | Pixels | Pixel thực tế (không khuyến khích) | Hiếm khi dùng |
| `pt` | Points | 1/72 inch | Không khuyến khích |
| `mm` | Millimeters | Millimet thực tế | Không khuyến khích |
| `in` | Inches | Inch thực tế | Không khuyến khích |

**Quy tắc sử dụng:**
- Luôn dùng `dp` cho kích thước layout.
- Luôn dùng `sp` cho text size.
- Tránh dùng `px` vì không scale theo màn hình.

#### 1.4.4 Tham chiếu Resources

```xml
<!-- Tham chiếu string -->
android:text="@string/hello_world"

<!-- Tham chiếu color -->
android:textColor="@color/black"

<!-- Tham chiếu dimension -->
android:textSize="@dimen/text_normal"

<!-- Tham chiếu drawable -->
android:background="@drawable/background"

<!-- Tham chiếu style -->
style="@style/MyButtonStyle"

<!-- Tham chiếu từ theme hiện tại -->
android:textColor="?attr/colorOnPrimary"
android:background="?attr/selectableItemBackground"
```

### 1.5 Khai báo và Khởi tạo Views (Declaring & Initializing Views)

#### 1.5.1 Khai báo View trong XML

Mỗi View cần được khai báo trong file layout XML:

```xml
<!-- res/layout/activity_main.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <TextView
        android:id="@+id/titleTextView"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Welcome"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <EditText
        android:id="@+id/nameEditText"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:hint="Enter your name"
        app:layout_constraintTop_toBottomOf="@id/titleTextView"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        android:layout_margin="16dp" />

    <Button
        android:id="@+id/submitButton"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Submit"
        app:layout_constraintTop_toBottomOf="@id/nameEditText"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

#### 1.5.2 Khởi tạo View trong Code - Cách 1: findViewById

Đây là cách truyền thống để truy cập View từ code:

```kotlin
class MainActivity : AppCompatActivity() {

    // Khai báo biến (có thể dùng lateinit hoặc nullable)
    private lateinit var titleTextView: TextView
    private lateinit var nameEditText: EditText
    private lateinit var submitButton: Button

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)  // Inflate layout

        // Khởi tạo View bằng findViewById
        titleTextView = findViewById(R.id.titleTextView)
        nameEditText = findViewById(R.id.nameEditText)
        submitButton = findViewById(R.id.submitButton)

        // Sử dụng View
        titleTextView.text = "Hello Android!"
        val name = nameEditText.text.toString()
    }
}
```

**Giải thích:**
- `setContentView(R.layout.activity_main)`: Nạp (inflate) file XML thành View objects.
- `findViewById<Type>(R.id.viewId)`: Tìm View theo ID và ép kiểu.
- `R.id.viewId`: ID được tự động generate trong class R.

**Nhược điểm của findViewById:**
- Không type-safe (có thể cast sai kiểu).
- Không null-safe (có thể return null nếu ID sai).
- Phải viết nhiều code boilerplate.
- Dễ gây crash runtime nếu ID không tồn tại.

#### 1.5.3 Khởi tạo View trong Code - Cách 2: View Binding (Khuyến nghị)

View Binding là cách hiện đại và an toàn hơn để truy cập View.

**Bước 1: Bật View Binding trong build.gradle.kts**
```kotlin
android {
    // ...existing code...
    buildFeatures {
        viewBinding = true
    }
}
```

**Bước 2: Sử dụng trong Activity**
```kotlin
class MainActivity : AppCompatActivity() {

    // Khai báo binding object
    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        // Khởi tạo binding
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // Truy cập View trực tiếp qua binding
        binding.titleTextView.text = "Hello Android!"
        binding.nameEditText.hint = "Enter your name"
        binding.submitButton.setOnClickListener {
            val name = binding.nameEditText.text.toString()
            binding.titleTextView.text = "Hello, $name!"
        }
    }
}
```

**Ưu điểm của View Binding:**
- **Type-safe**: Tự động generate đúng kiểu cho mỗi View.
- **Null-safe**: Không có View nào là null (trừ khi dùng `<include>`).
- **Compile-time check**: Lỗi được phát hiện khi compile, không phải runtime.
- **Ít code hơn**: Không cần khai báo biến riêng cho mỗi View.

**Quy tắc đặt tên:**
- Layout file: `activity_main.xml` → Binding class: `ActivityMainBinding`
- Layout file: `fragment_home.xml` → Binding class: `FragmentHomeBinding`
- View ID: `titleTextView` → Property: `binding.titleTextView`
- View ID: `submit_button` → Property: `binding.submitButton` (camelCase)

#### 1.5.4 So sánh các cách khởi tạo View

| Tiêu chí | findViewById | View Binding | Data Binding |
|----------|--------------|--------------|--------------|
| Type-safe | Không | Có | Có |
| Null-safe | Không | Có | Có |
| Setup | Không cần | Bật trong gradle | Bật trong gradle |
| Hiệu năng | Chậm nhất | Nhanh | Trung bình |
| Code boilerplate | Nhiều | Ít | Ít nhất |
| Two-way binding | Không | Không | Có |
| Khuyến nghị | Không | Có | Tùy trường hợp |

### 1.6 EditText - Nhập văn bản

#### 1.6.1 Giới thiệu EditText

**EditText** là View cho phép người dùng nhập và chỉnh sửa văn bản. EditText kế thừa từ TextView nên có tất cả thuộc tính của TextView.

#### 1.6.2 Các thuộc tính quan trọng của EditText

```xml
<EditText
    android:id="@+id/emailEditText"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:hint="Enter your email"
    android:inputType="textEmailAddress"
    android:maxLength="50"
    android:maxLines="1"
    android:imeOptions="actionNext"
    android:drawableStart="@drawable/ic_email"
    android:drawablePadding="8dp" />
```

| Thuộc tính | Mô tả |
|------------|-------|
| `hint` | Văn bản gợi ý khi EditText trống |
| `inputType` | Loại bàn phím và định dạng input |
| `maxLength` | Số ký tự tối đa |
| `maxLines` | Số dòng tối đa |
| `imeOptions` | Nút action trên bàn phím (Next, Done, Search,...) |
| `textColorHint` | Màu của hint text |
| `autofillHints` | Gợi ý cho autofill |

#### 1.6.3 Các loại inputType

`inputType` quyết định loại bàn phím và cách xử lý input:

```xml
<!-- Text thường -->
android:inputType="text"

<!-- Password (ẩn ký tự) -->
android:inputType="textPassword"

<!-- Password hiển thị -->
android:inputType="textVisiblePassword"

<!-- Email -->
android:inputType="textEmailAddress"

<!-- Số điện thoại -->
android:inputType="phone"

<!-- Số -->
android:inputType="number"

<!-- Số có dấu thập phân -->
android:inputType="numberDecimal"

<!-- Số có dấu âm dương -->
android:inputType="numberSigned"

<!-- Số thập phân có dấu -->
android:inputType="numberDecimal|numberSigned"

<!-- Nhiều dòng -->
android:inputType="textMultiLine"

<!-- Tên người (viết hoa chữ cái đầu mỗi từ) -->
android:inputType="textPersonName"

<!-- Viết hoa chữ cái đầu câu -->
android:inputType="textCapSentences"

<!-- Viết hoa tất cả -->
android:inputType="textCapCharacters"

<!-- URI / URL -->
android:inputType="textUri"

<!-- Ngày tháng -->
android:inputType="date"

<!-- Thời gian -->
android:inputType="time"
```

#### 1.6.4 Các loại imeOptions

`imeOptions` quyết định nút action trên bàn phím:

```xml
android:imeOptions="actionDone"      <!-- Nút Done, đóng bàn phím -->
android:imeOptions="actionNext"      <!-- Nút Next, chuyển sang field tiếp -->
android:imeOptions="actionGo"        <!-- Nút Go -->
android:imeOptions="actionSearch"    <!-- Nút Search -->
android:imeOptions="actionSend"      <!-- Nút Send -->
android:imeOptions="actionNone"      <!-- Không có nút action -->
```

#### 1.6.5 Làm việc với EditText trong Code

```kotlin
class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // Lấy text từ EditText
        val email = binding.emailEditText.text.toString()

        // Set text cho EditText
        binding.emailEditText.setText("example@email.com")

        // Xóa text
        binding.emailEditText.text.clear()
        // hoặc
        binding.emailEditText.setText("")

        // Lắng nghe thay đổi text
        binding.emailEditText.addTextChangedListener(object : TextWatcher {
            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {
                // Trước khi text thay đổi
            }

            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {
                // Khi text đang thay đổi
                Log.d("EditText", "Text: $s")
            }

            override fun afterTextChanged(s: Editable?) {
                // Sau khi text thay đổi
                validateEmail(s.toString())
            }
        })

        // Lắng nghe khi nhấn nút action trên bàn phím
        binding.emailEditText.setOnEditorActionListener { _, actionId, _ ->
            if (actionId == EditorInfo.IME_ACTION_DONE) {
                // Xử lý khi nhấn Done
                hideKeyboard()
                true
            } else {
                false
            }
        }

        // Focus vào EditText
        binding.emailEditText.requestFocus()

        // Hiển thị bàn phím
        val imm = getSystemService(INPUT_METHOD_SERVICE) as InputMethodManager
        imm.showSoftInput(binding.emailEditText, InputMethodManager.SHOW_IMPLICIT)
    }

    private fun hideKeyboard() {
        val imm = getSystemService(INPUT_METHOD_SERVICE) as InputMethodManager
        imm.hideSoftInputFromWindow(binding.emailEditText.windowToken, 0)
    }

    private fun validateEmail(email: String) {
        if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
            binding.emailEditText.error = "Invalid email format"
        }
    }
}
```

#### 1.6.6 TextInputLayout (Material Design)

Để có EditText đẹp hơn với animation và error handling tốt hơn, sử dụng `TextInputLayout`:

```xml
<com.google.android.material.textfield.TextInputLayout
    android:id="@+id/emailInputLayout"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:hint="Email"
    app:errorEnabled="true"
    app:startIconDrawable="@drawable/ic_email"
    style="@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox">

    <com.google.android.material.textfield.TextInputEditText
        android:id="@+id/emailEditText"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:inputType="textEmailAddress" />

</com.google.android.material.textfield.TextInputLayout>
```

```kotlin
// Hiển thị error
binding.emailInputLayout.error = "Please enter a valid email"

// Xóa error
binding.emailInputLayout.error = null
binding.emailInputLayout.isErrorEnabled = false
```

### 1.7 Buttons và Click Listeners

#### 1.7.1 Các loại Button

**Button thường:**
```xml
<Button
    android:id="@+id/normalButton"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Normal Button" />
```

**MaterialButton (khuyến nghị):**
```xml
<com.google.android.material.button.MaterialButton
    android:id="@+id/materialButton"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Material Button"
    app:icon="@drawable/ic_send"
    app:iconGravity="textStart" />
```

**Các style của MaterialButton:**
```xml
<!-- Filled Button (mặc định) -->
<Button
    style="@style/Widget.MaterialComponents.Button" />

<!-- Outlined Button -->
<Button
    style="@style/Widget.MaterialComponents.Button.OutlinedButton" />

<!-- Text Button -->
<Button
    style="@style/Widget.MaterialComponents.Button.TextButton" />

<!-- Icon Button -->
<Button
    style="@style/Widget.MaterialComponents.Button.Icon" />
```

**ImageButton:**
```xml
<ImageButton
    android:id="@+id/imageButton"
    android:layout_width="48dp"
    android:layout_height="48dp"
    android:src="@drawable/ic_favorite"
    android:background="?attr/selectableItemBackgroundBorderless"
    android:contentDescription="Favorite" />
```

**FloatingActionButton (FAB):**
```xml
<com.google.android.material.floatingactionbutton.FloatingActionButton
    android:id="@+id/fab"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:src="@drawable/ic_add"
    android:contentDescription="Add item" />
```

#### 1.7.2 Thuộc tính Button

```xml
<Button
    android:id="@+id/myButton"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Click Me"
    android:textColor="@color/white"
    android:textSize="16sp"
    android:textAllCaps="false"
    android:enabled="true"
    android:backgroundTint="@color/primary"
    android:stateListAnimator="@null"
    app:cornerRadius="8dp"
    app:icon="@drawable/ic_send"
    app:iconGravity="textStart"
    app:iconPadding="8dp"
    app:rippleColor="@color/ripple" />
```

| Thuộc tính | Mô tả |
|------------|-------|
| `text` | Văn bản trên button |
| `textAllCaps` | Tự động viết hoa (mặc định true) |
| `enabled` | Bật/tắt button |
| `backgroundTint` | Màu nền |
| `cornerRadius` | Bo góc |
| `icon` | Icon trên button |
| `iconGravity` | Vị trí icon (textStart, textEnd, start, end, top) |
| `rippleColor` | Màu hiệu ứng ripple khi click |

#### 1.7.3 Click Listeners - Xử lý sự kiện click

**Cách 1: setOnClickListener với Lambda (Khuyến nghị)**
```kotlin
binding.myButton.setOnClickListener {
    // Code xử lý khi click
    Toast.makeText(this, "Button clicked!", Toast.LENGTH_SHORT).show()
}
```

**Cách 2: setOnClickListener với Object**
```kotlin
binding.myButton.setOnClickListener(object : View.OnClickListener {
    override fun onClick(v: View?) {
        // Code xử lý
    }
})
```

**Cách 3: Activity implement OnClickListener**
```kotlin
class MainActivity : AppCompatActivity(), View.OnClickListener {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // Gán listener
        binding.button1.setOnClickListener(this)
        binding.button2.setOnClickListener(this)
        binding.button3.setOnClickListener(this)
    }

    override fun onClick(v: View?) {
        when (v?.id) {
            R.id.button1 -> handleButton1Click()
            R.id.button2 -> handleButton2Click()
            R.id.button3 -> handleButton3Click()
        }
    }
}
```

**Cách 4: Khai báo trong XML (Không khuyến nghị)**
```xml
<Button
    android:onClick="onButtonClick" />
```

```kotlin
// Trong Activity - phương thức phải public
fun onButtonClick(view: View) {
    // Code xử lý
}
```

#### 1.7.4 Các loại Click Listener khác

**Long Click Listener (Nhấn giữ):**
```kotlin
binding.myButton.setOnLongClickListener {
    Toast.makeText(this, "Long pressed!", Toast.LENGTH_SHORT).show()
    true  // return true để consume event
}
```

**Touch Listener (Chạm - chi tiết hơn):**
```kotlin
binding.myButton.setOnTouchListener { v, event ->
    when (event.action) {
        MotionEvent.ACTION_DOWN -> {
            // Ngón tay chạm vào
        }
        MotionEvent.ACTION_UP -> {
            // Ngón tay nhấc lên
        }
        MotionEvent.ACTION_MOVE -> {
            // Ngón tay di chuyển
        }
    }
    false  // return false để tiếp tục propagate event
}
```

#### 1.7.5 Ví dụ thực tế: Form đăng nhập

```kotlin
class LoginActivity : AppCompatActivity() {

    private lateinit var binding: ActivityLoginBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityLoginBinding.inflate(layoutInflater)
        setContentView(binding.root)

        setupClickListeners()
    }

    private fun setupClickListeners() {
        // Nút đăng nhập
        binding.loginButton.setOnClickListener {
            val email = binding.emailEditText.text.toString().trim()
            val password = binding.passwordEditText.text.toString()

            if (validateInput(email, password)) {
                performLogin(email, password)
            }
        }

        // Nút đăng ký
        binding.registerButton.setOnClickListener {
            startActivity(Intent(this, RegisterActivity::class.java))
        }

        // Link quên mật khẩu
        binding.forgotPasswordText.setOnClickListener {
            showForgotPasswordDialog()
        }

        // Disable nút khi đang loading
        binding.loginButton.isEnabled = true
    }

    private fun validateInput(email: String, password: String): Boolean {
        var isValid = true

        if (email.isEmpty()) {
            binding.emailInputLayout.error = "Email is required"
            isValid = false
        } else if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
            binding.emailInputLayout.error = "Invalid email format"
            isValid = false
        } else {
            binding.emailInputLayout.error = null
        }

        if (password.isEmpty()) {
            binding.passwordInputLayout.error = "Password is required"
            isValid = false
        } else if (password.length < 6) {
            binding.passwordInputLayout.error = "Password must be at least 6 characters"
            isValid = false
        } else {
            binding.passwordInputLayout.error = null
        }

        return isValid
    }

    private fun performLogin(email: String, password: String) {
        // Hiển thị loading
        binding.loginButton.isEnabled = false
        binding.progressBar.visibility = View.VISIBLE

        // Thực hiện đăng nhập (API call, Firebase,...)
    }
}
```

### 1.8 ImageView - Hiển thị hình ảnh

#### 1.8.1 Giới thiệu ImageView

**ImageView** là View dùng để hiển thị hình ảnh từ nhiều nguồn khác nhau: drawable resource, file, URL,...

#### 1.8.2 Khai báo ImageView trong XML

```xml
<ImageView
    android:id="@+id/myImageView"
    android:layout_width="200dp"
    android:layout_height="200dp"
    android:src="@drawable/my_image"
    android:scaleType="centerCrop"
    android:contentDescription="Profile picture"
    android:adjustViewBounds="true" />
```

#### 1.8.3 Các thuộc tính quan trọng

| Thuộc tính | Mô tả |
|------------|-------|
| `src` | Nguồn ảnh (drawable, mipmap) |
| `scaleType` | Cách scale ảnh vào ImageView |
| `contentDescription` | Mô tả cho accessibility (TalkBack) |
| `adjustViewBounds` | Điều chỉnh bounds theo tỉ lệ ảnh |
| `tint` | Tô màu lên ảnh |
| `background` | Nền (khác với src) |

#### 1.8.4 Các loại ScaleType

ScaleType quyết định cách ảnh được scale và căn chỉnh trong ImageView:

```xml
android:scaleType="centerCrop"
```

| ScaleType | Mô tả |
|-----------|-------|
| `center` | Căn giữa, không scale |
| `centerCrop` | Scale đều để fill, cắt phần thừa, căn giữa |
| `centerInside` | Scale để vừa bên trong, căn giữa |
| `fitCenter` | Scale để vừa bên trong, căn giữa (mặc định) |
| `fitStart` | Scale để vừa bên trong, căn ở đầu (top/left) |
| `fitEnd` | Scale để vừa bên trong, căn ở cuối (bottom/right) |
| `fitXY` | Scale không đều để fill đầy (có thể méo) |
| `matrix` | Scale và dịch chuyển bằng matrix tùy chỉnh |

**Minh họa ScaleType:**
```
Ảnh gốc: 100x50 (ngang)
ImageView: 50x50 (vuông)

centerCrop:          centerInside:        fitXY:
┌─────────┐          ┌─────────┐          ┌─────────┐
│ ▓▓▓▓▓▓▓ │          │         │          │▓▓▓▓▓▓▓▓▓│
│ ▓▓▓▓▓▓▓ │          │▓▓▓▓▓▓▓▓▓│          │▓▓▓▓▓▓▓▓▓│
│ ▓▓▓▓▓▓▓ │          │         │          │▓▓▓▓▓▓▓▓▓│
└─────────┘          └─────────┘          └─────────┘
(cắt 2 bên)          (có khoảng trống)    (bị méo)
```

#### 1.8.5 Làm việc với ImageView trong Code

```kotlin
class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        // Set ảnh từ drawable resource
        binding.myImageView.setImageResource(R.drawable.my_image)

        // Set ảnh từ Drawable object
        val drawable = ContextCompat.getDrawable(this, R.drawable.my_image)
        binding.myImageView.setImageDrawable(drawable)

        // Set ảnh từ Bitmap
        val bitmap = BitmapFactory.decodeResource(resources, R.drawable.my_image)
        binding.myImageView.setImageBitmap(bitmap)

        // Set scaleType trong code
        binding.myImageView.scaleType = ImageView.ScaleType.CENTER_CROP

        // Tint màu cho ảnh
        binding.myImageView.setColorFilter(
            ContextCompat.getColor(this, R.color.primary),
            PorterDuff.Mode.SRC_IN
        )

        // Hoặc dùng ImageViewCompat
        ImageViewCompat.setImageTintList(
            binding.myImageView,
            ColorStateList.valueOf(Color.RED)
        )

        // Xóa tint
        binding.myImageView.clearColorFilter()

        // Set alpha (độ trong suốt)
        binding.myImageView.alpha = 0.5f

        // Click listener cho ImageView
        binding.myImageView.setOnClickListener {
            openFullScreenImage()
        }
    }
}
```

#### 1.8.6 Load ảnh từ Internet với Glide

Để load ảnh từ URL, nên dùng thư viện như **Glide** hoặc **Coil**:

**Thêm dependency (build.gradle.kts):**
```kotlin
dependencies {
    implementation("com.github.bumptech.glide:glide:4.16.0")
}
```

**Thêm permission (AndroidManifest.xml):**
```xml
<uses-permission android:name="android.permission.INTERNET" />
```

**Sử dụng Glide:**
```kotlin
// Load ảnh từ URL
Glide.with(this)
    .load("https://example.com/image.jpg")
    .into(binding.myImageView)

// Với placeholder và error
Glide.with(this)
    .load("https://example.com/image.jpg")
    .placeholder(R.drawable.placeholder)  // Ảnh hiển thị khi đang load
    .error(R.drawable.error_image)        // Ảnh hiển thị khi lỗi
    .into(binding.myImageView)

// Với các tùy chọn khác
Glide.with(this)
    .load("https://example.com/image.jpg")
    .centerCrop()                         // ScaleType
    .circleCrop()                         // Cắt thành hình tròn
    .override(300, 300)                   // Resize
    .timeout(10000)                       // Timeout 10 giây
    .into(binding.myImageView)
```

#### 1.8.7 Load ảnh với Coil (Coroutine Image Loader)

**Thêm dependency:**
```kotlin
dependencies {
    implementation("io.coil-kt:coil:2.5.0")
}
```

**Sử dụng Coil:**
```kotlin
// Load ảnh đơn giản
binding.myImageView.load("https://example.com/image.jpg")

// Với options
binding.myImageView.load("https://example.com/image.jpg") {
    crossfade(true)
    placeholder(R.drawable.placeholder)
    error(R.drawable.error_image)
    transformations(CircleCropTransformation())
}
```

#### 1.8.8 ShapeableImageView (Material Design)

Để có ImageView với bo góc, viền, hình dạng đặc biệt:

```xml
<com.google.android.material.imageview.ShapeableImageView
    android:id="@+id/profileImage"
    android:layout_width="100dp"
    android:layout_height="100dp"
    android:src="@drawable/avatar"
    android:scaleType="centerCrop"
    app:shapeAppearanceOverlay="@style/CircleImageView"
    app:strokeWidth="2dp"
    app:strokeColor="@color/primary" />
```

**Định nghĩa shape trong styles.xml:**
```xml
<!-- Hình tròn -->
<style name="CircleImageView" parent="">
    <item name="cornerFamily">rounded</item>
    <item name="cornerSize">50%</item>
</style>

<!-- Bo góc -->
<style name="RoundedImageView" parent="">
    <item name="cornerFamily">rounded</item>
    <item name="cornerSize">16dp</item>
</style>

<!-- Bo góc một số cạnh -->
<style name="TopRoundedImageView" parent="">
    <item name="cornerFamily">rounded</item>
    <item name="cornerSizeTopLeft">16dp</item>
    <item name="cornerSizeTopRight">16dp</item>
    <item name="cornerSizeBottomLeft">0dp</item>
    <item name="cornerSizeBottomRight">0dp</item>
</style>
```

### 1.9 Tài nguyên (Resources)

Thay vì viết trực tiếp giá trị trong XML hoặc code, Android khuyến khích sử dụng resource files:

#### 1.9.1 String Resources (res/values/strings.xml)
```xml
<resources>
    <string name="app_name">My App</string>
    <string name="welcome_message">Welcome, %1$s!</string>
    <string name="item_count">%d items</string>
    <plurals name="items_plural">
        <item quantity="one">%d item</item>
        <item quantity="other">%d items</item>
    </plurals>
</resources>
```

#### 1.9.2 Color Resources (res/values/colors.xml)
```xml
<resources>
    <color name="primary">#6200EE</color>
    <color name="primary_dark">#3700B3</color>
    <color name="accent">#03DAC5</color>
    <color name="black_50">#80000000</color>  <!-- 50% transparent black -->
</resources>
```

#### 1.9.3 Dimension Resources (res/values/dimens.xml)
```xml
<resources>
    <dimen name="padding_small">8dp</dimen>
    <dimen name="padding_medium">16dp</dimen>
    <dimen name="padding_large">24dp</dimen>
    <dimen name="text_small">12sp</dimen>
    <dimen name="text_normal">14sp</dimen>
    <dimen name="text_large">18sp</dimen>
</resources>
```

#### 1.9.4 Sử dụng Resources

**Trong XML:**
```xml
android:text="@string/welcome_message"
android:textColor="@color/primary"
android:padding="@dimen/padding_medium"
android:background="@drawable/background"
```

**Trong Code:**
```kotlin
// String
val appName = getString(R.string.app_name)
val welcome = getString(R.string.welcome_message, "John")

// Color
val color = ContextCompat.getColor(this, R.color.primary)

// Dimension
val padding = resources.getDimensionPixelSize(R.dimen.padding_medium)

// Drawable
val drawable = ContextCompat.getDrawable(this, R.drawable.icon)
```