## 1) Layouts trong Android

### 1.1 Giới thiệu về Layouts (Introduction to Layouts)

Trong Android, **Layout** là một lớp con của **ViewGroup**, có nhiệm vụ xác định cấu trúc giao diện người dùng (UI). Layout quyết định cách các View con được sắp xếp và hiển thị trên màn hình.

**Tại sao cần Layout?**
- Tổ chức các thành phần UI một cách có hệ thống.
- Đảm bảo giao diện hiển thị đúng trên nhiều kích thước màn hình khác nhau.
- Tạo ra giao diện responsive (đáp ứng) và linh hoạt.
- Dễ dàng bảo trì và chỉnh sửa giao diện.

**Cách hoạt động:**
1. Layout được khai báo trong file XML (thường nằm trong `res/layout/`).
2. Mỗi Layout có thể chứa các View con (Button, TextView,...) hoặc các Layout con khác.
3. Khi Activity được tạo, `setContentView()` sẽ inflate (chuyển đổi) XML thành các đối tượng View trong bộ nhớ.

**Ví dụ cơ bản:**
```xml
<!-- Một Layout đơn giản chứa 2 View con -->
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">
    
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Xin chào!" />
    
    <Button
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Bấm vào đây" />
</LinearLayout>
```

### 1.2 Các loại Layouts phổ biến (Types of Layouts)

Android cung cấp nhiều loại Layout khác nhau, mỗi loại phù hợp với các tình huống khác nhau:

| Layout | Mô tả | Khi nào sử dụng |
|--------|-------|-----------------|
| **LinearLayout** | Sắp xếp View theo hàng ngang hoặc dọc | Giao diện đơn giản, danh sách các phần tử theo một chiều |
| **RelativeLayout** | Đặt View tương đối với View khác hoặc với parent | Giao diện phức tạp hơn, cần linh hoạt vị trí |
| **ConstraintLayout** | Đặt View dựa trên ràng buộc (constraint) | Giao diện phức tạp, tối ưu hiệu năng, khuyến nghị dùng |
| **FrameLayout** | Xếp chồng View lên nhau | Hiển thị một View tại một thời điểm, overlay |
| **TableLayout** | Sắp xếp View theo dạng bảng (hàng/cột) | Giao diện dạng lưới đơn giản |
| **GridLayout** | Sắp xếp View theo lưới linh hoạt | Lưới phức tạp với các ô có kích thước khác nhau |
| **CoordinatorLayout** | Layout đặc biệt hỗ trợ animation và behavior | App bar, FAB, scrolling behavior |

**Lưu ý quan trọng:**
- **ConstraintLayout** được Google khuyến nghị sử dụng cho hầu hết các trường hợp vì hiệu năng tốt và tính linh hoạt cao.
- Tránh lồng quá nhiều Layout vào nhau (nested layouts) vì ảnh hưởng hiệu năng.

### 1.3 LinearLayout

**LinearLayout** là layout đơn giản nhất, sắp xếp các View con theo một hướng duy nhất: **ngang (horizontal)** hoặc **dọc (vertical)**.

#### Thuộc tính quan trọng:

| Thuộc tính | Mô tả |
|------------|-------|
| `android:orientation` | `vertical` (dọc) hoặc `horizontal` (ngang) |
| `android:gravity` | Căn lề nội dung bên trong Layout |
| `android:layout_weight` | Phân chia không gian còn lại cho View con |
| `android:weightSum` | Tổng weight của Layout (mặc định là tổng weight các con) |

#### Ví dụ LinearLayout dọc (Vertical):
```xml
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">
    
    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Tiêu đề"
        android:textSize="24sp"
        android:textStyle="bold" />
    
    <EditText
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Nhập tên của bạn"
        android:layout_marginTop="8dp" />
    
    <Button
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Gửi"
        android:layout_marginTop="16dp" />
</LinearLayout>
```

#### Ví dụ LinearLayout ngang (Horizontal):
```xml
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal">
    
    <Button
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_weight="1"
        android:text="Hủy" />
    
    <Button
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_weight="1"
        android:text="Đồng ý" />
</LinearLayout>
```

#### Giải thích `layout_weight`:
- Khi sử dụng `layout_weight`, đặt `layout_width="0dp"` (horizontal) hoặc `layout_height="0dp"` (vertical).
- View có weight lớn hơn sẽ chiếm nhiều không gian hơn.
- Ví dụ: 2 Button với weight = 1 sẽ chia đều 50% - 50% không gian.

**Ưu điểm:**
- Dễ hiểu, dễ sử dụng cho người mới.
- Phù hợp với giao diện đơn giản.

**Nhược điểm:**
- Không linh hoạt khi giao diện phức tạp.
- Cần lồng nhiều LinearLayout gây ảnh hưởng hiệu năng.

### 1.4 RelativeLayout

**RelativeLayout** cho phép đặt vị trí các View **tương đối** với:
- Parent (Layout cha).
- Các View anh em khác.

#### Thuộc tính đặt vị trí tương đối với Parent:

| Thuộc tính | Mô tả |
|------------|-------|
| `android:layout_alignParentTop` | Căn với cạnh trên của parent |
| `android:layout_alignParentBottom` | Căn với cạnh dưới của parent |
| `android:layout_alignParentStart` | Căn với cạnh trái của parent |
| `android:layout_alignParentEnd` | Căn với cạnh phải của parent |
| `android:layout_centerInParent` | Căn giữa parent |
| `android:layout_centerHorizontal` | Căn giữa theo chiều ngang |
| `android:layout_centerVertical` | Căn giữa theo chiều dọc |

#### Thuộc tính đặt vị trí tương đối với View khác:

| Thuộc tính | Mô tả |
|------------|-------|
| `android:layout_above` | Đặt phía trên View được chỉ định |
| `android:layout_below` | Đặt phía dưới View được chỉ định |
| `android:layout_toStartOf` | Đặt bên trái View được chỉ định |
| `android:layout_toEndOf` | Đặt bên phải View được chỉ định |
| `android:layout_alignTop` | Căn cạnh trên với View được chỉ định |
| `android:layout_alignBottom` | Căn cạnh dưới với View được chỉ định |
| `android:layout_alignBaseline` | Căn baseline (đường cơ sở văn bản) |

#### Ví dụ RelativeLayout:
```xml
<RelativeLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp">
    
    <!-- Tiêu đề ở trên cùng, căn giữa -->
    <TextView
        android:id="@+id/titleText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentTop="true"
        android:layout_centerHorizontal="true"
        android:text="Đăng nhập"
        android:textSize="28sp" />
    
    <!-- Ô nhập username, bên dưới tiêu đề -->
    <EditText
        android:id="@+id/usernameInput"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_below="@id/titleText"
        android:layout_marginTop="32dp"
        android:hint="Tên đăng nhập" />
    
    <!-- Ô nhập password, bên dưới username -->
    <EditText
        android:id="@+id/passwordInput"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_below="@id/usernameInput"
        android:layout_marginTop="16dp"
        android:hint="Mật khẩu"
        android:inputType="textPassword" />
    
    <!-- Nút đăng nhập, ở dưới cùng màn hình -->
    <Button
        android:id="@+id/loginButton"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_alignParentBottom="true"
        android:text="Đăng nhập" />
    
    <!-- Nút quên mật khẩu, phía trên nút đăng nhập -->
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_above="@id/loginButton"
        android:layout_centerHorizontal="true"
        android:layout_marginBottom="16dp"
        android:text="Quên mật khẩu?"
        android:textColor="#1976D2" />
</RelativeLayout>
```

**Ưu điểm:**
- Linh hoạt hơn LinearLayout.
- Giảm được việc lồng nhiều Layout.

**Nhược điểm:**
- Khó quản lý khi có nhiều View.
- Hiệu năng không tốt bằng ConstraintLayout.
- Đã bị thay thế bởi ConstraintLayout trong các dự án mới.

### 1.5 ConstraintLayout là gì? (What's Constraint Layout?)

**ConstraintLayout** là layout mạnh mẽ và linh hoạt nhất trong Android, được Google giới thiệu như giải pháp thay thế cho cả LinearLayout và RelativeLayout.

#### Khái niệm cốt lõi:

**Constraint (Ràng buộc)** là mối quan hệ giữa một View với:
- Parent (Layout cha).
- Các View anh em khác.
- Các guideline (đường hướng dẫn ảo).

Mỗi View cần **ít nhất một constraint ngang** và **một constraint dọc** để xác định vị trí.

#### Tại sao nên dùng ConstraintLayout?

1. **Hiệu năng tốt**: Layout phẳng (flat hierarchy), không cần lồng nhiều layout.
2. **Linh hoạt**: Có thể tạo mọi loại giao diện mà không cần lồng layout.
3. **Hỗ trợ design tool**: Android Studio cung cấp visual editor mạnh mẽ.
4. **Responsive**: Dễ dàng tạo giao diện thích ứng với nhiều kích thước màn hình.
5. **Animation**: Hỗ trợ MotionLayout cho animation phức tạp.

#### So sánh với các Layout khác:

| Tiêu chí | LinearLayout | RelativeLayout | ConstraintLayout |
|----------|--------------|----------------|------------------|
| Độ phức tạp | Đơn giản | Trung bình | Cao (nhưng mạnh mẽ) |
| Hiệu năng | Tốt (nếu không lồng) | Trung bình | Tốt nhất |
| Linh hoạt | Thấp | Trung bình | Cao nhất |
| Visual Editor | Hạn chế | Hạn chế | Tốt nhất |
| Google khuyến nghị | Không | Không | **Có** |

### 1.6 ConstraintLayout trong Android Studio

Android Studio cung cấp **Layout Editor** mạnh mẽ để thiết kế giao diện với ConstraintLayout một cách trực quan.

#### Các thành phần trong Layout Editor:

1. **Design View**: Xem giao diện như khi chạy app.
2. **Blueprint View**: Xem cấu trúc constraint (đường kẻ xanh).
3. **Component Tree**: Cây các View trong layout.
4. **Attributes Panel**: Chỉnh sửa thuộc tính của View được chọn.
5. **Palette**: Kéo thả các View vào layout.

#### Cách tạo Constraint bằng chuột:

1. **Kéo thả View** từ Palette vào Design/Blueprint view.
2. **Tạo constraint**: Click vào điểm tròn ở cạnh View, kéo đến cạnh parent hoặc View khác.
3. **Xóa constraint**: Click vào constraint rồi nhấn Delete, hoặc click vào điểm tròn.
4. **Chỉnh margin**: Dùng Attributes panel hoặc kéo trực tiếp.

#### Các công cụ hữu ích trong toolbar:

- **Infer Constraints**: Tự động tạo constraint cho các View chưa có.
- **Clear All Constraints**: Xóa tất cả constraint.
- **Pack**: Gom các View lại gần nhau.
- **Align**: Căn lề nhiều View cùng lúc.
- **Guidelines**: Thêm đường guideline.
- **Barriers**: Thêm barrier.

#### Ví dụ tạo constraint trong XML:

```xml
<androidx.constraintlayout.widget.ConstraintLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    
    <Button
        android:id="@+id/buttonA"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Button A"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        android:layout_margin="16dp" />
    
    <Button
        android:id="@+id/buttonB"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Button B"
        app:layout_constraintStart_toEndOf="@id/buttonA"
        app:layout_constraintTop_toTopOf="@id/buttonA"
        android:layout_marginStart="16dp" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

### 1.7 Chi tiết về ConstraintLayout (More about Constraint Layout)

#### 1.7.1 Các loại Constraint

**Constraint cạnh (Edge Constraints):**
```xml
<!-- Constraint với parent -->
app:layout_constraintStart_toStartOf="parent"
app:layout_constraintEnd_toEndOf="parent"
app:layout_constraintTop_toTopOf="parent"
app:layout_constraintBottom_toBottomOf="parent"

<!-- Constraint với View khác -->
app:layout_constraintStart_toEndOf="@id/otherView"
app:layout_constraintTop_toBottomOf="@id/otherView"
```

**Constraint baseline (cho văn bản):**
```xml
app:layout_constraintBaseline_toBaselineOf="@id/textView"
```

#### 1.7.2 Bias (Độ lệch)

Khi View có constraint ở cả hai phía (ví dụ: start và end), bạn có thể điều chỉnh vị trí bằng **bias**:

```xml
<!-- Bias 0.5 = căn giữa (mặc định) -->
<!-- Bias 0 = sát bên trái, Bias 1 = sát bên phải -->
app:layout_constraintHorizontal_bias="0.3"
app:layout_constraintVertical_bias="0.7"
```

#### 1.7.3 Kích thước View trong ConstraintLayout

**Các giá trị cho layout_width / layout_height:**

| Giá trị | Mô tả |
|---------|-------|
| `wrap_content` | Vừa với nội dung |
| `match_parent` | **Không khuyến khích** trong ConstraintLayout |
| `0dp` (match_constraint) | Kích thước theo constraint |
| Số cụ thể (vd: `100dp`) | Kích thước cố định |

**Ví dụ match_constraint:**
```xml
<Button
    android:layout_width="0dp"
    android:layout_height="wrap_content"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintEnd_toEndOf="parent"
    android:layout_marginStart="16dp"
    android:layout_marginEnd="16dp"
    android:text="Button full width với margin" />
```

#### 1.7.4 Chains (Chuỗi)

**Chain** là nhóm các View được liên kết với nhau theo chiều ngang hoặc dọc, cho phép phân bố không gian giữa các View.

**Các loại Chain style:**

| Style | Mô tả |
|-------|-------|
| `spread` | Phân bố đều không gian (mặc định) |
| `spread_inside` | Phân bố đều, View đầu và cuối sát cạnh |
| `packed` | Các View gom lại, có thể dùng bias để dịch chuyển |
| `weighted` | Kết hợp với layout_weight để phân chia theo tỉ lệ |

**Ví dụ Chain ngang:**
```xml
<!-- View đầu tiên định nghĩa chain style -->
<Button
    android:id="@+id/btn1"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    app:layout_constraintHorizontal_chainStyle="spread"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintEnd_toStartOf="@id/btn2"
    android:text="1" />

<Button
    android:id="@+id/btn2"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    app:layout_constraintStart_toEndOf="@id/btn1"
    app:layout_constraintEnd_toStartOf="@id/btn3"
    android:text="2" />

<Button
    android:id="@+id/btn3"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    app:layout_constraintStart_toEndOf="@id/btn2"
    app:layout_constraintEnd_toEndOf="parent"
    android:text="3" />
```

#### 1.7.5 Guidelines (Đường hướng dẫn)

**Guideline** là đường ảo (không hiển thị) dùng để đặt constraint.

```xml
<!-- Guideline dọc ở vị trí 30% chiều rộng màn hình -->
<androidx.constraintlayout.widget.Guideline
    android:id="@+id/guideline"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    app:layout_constraintGuide_percent="0.3" />

<!-- Hoặc dùng giá trị cố định -->
<androidx.constraintlayout.widget.Guideline
    android:id="@+id/guideline2"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    app:layout_constraintGuide_begin="100dp" />
```

#### 1.7.6 Barriers (Rào cản)

**Barrier** là đường ảo có vị trí phụ thuộc vào một nhóm View. Hữu ích khi bạn không biết trước View nào sẽ lớn hơn.

```xml
<!-- Barrier sẽ ở vị trí bên phải của View lớn nhất trong nhóm -->
<androidx.constraintlayout.widget.Barrier
    android:id="@+id/barrier"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    app:barrierDirection="end"
    app:constraint_referenced_ids="label1,label2,label3" />

<!-- View này sẽ luôn ở bên phải tất cả các label -->
<EditText
    android:layout_width="0dp"
    android:layout_height="wrap_content"
    app:layout_constraintStart_toEndOf="@id/barrier"
    app:layout_constraintEnd_toEndOf="parent" />
```

#### 1.7.7 Group (Nhóm)

**Group** cho phép điều khiển visibility của nhiều View cùng lúc.

```xml
<androidx.constraintlayout.widget.Group
    android:id="@+id/group"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:visibility="visible"
    app:constraint_referenced_ids="button1,button2,textView1" />
```

Trong code Kotlin:
```kotlin
group.visibility = View.GONE  // Ẩn tất cả View trong group
group.visibility = View.VISIBLE  // Hiện tất cả View trong group
```

#### 1.7.8 Tỉ lệ khung hình (Dimension Ratio)

Giữ tỉ lệ chiều rộng/chiều cao của View:

```xml
<!-- Hình vuông -->
<ImageView
    android:layout_width="0dp"
    android:layout_height="0dp"
    app:layout_constraintDimensionRatio="1:1"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintTop_toTopOf="parent" />

<!-- Tỉ lệ 16:9 -->
<ImageView
    android:layout_width="0dp"
    android:layout_height="0dp"
    app:layout_constraintDimensionRatio="H,16:9"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintTop_toTopOf="parent" />
```

#### 1.7.9 Best Practices khi dùng ConstraintLayout

1. **Tránh lồng ConstraintLayout**: Một ConstraintLayout phẳng thường đủ cho hầu hết giao diện.
2. **Sử dụng Guidelines cho responsive design**: Dùng percent thay vì giá trị cố định.
3. **Dùng Barriers khi nội dung động**: Khi không biết trước View nào sẽ lớn hơn.
4. **Dùng Chains để phân bố View**: Thay vì tính toán margin thủ công.
5. **Dùng 0dp thay vì match_parent**: Trong ConstraintLayout, dùng `0dp` với constraint để mở rộng View.
6. **Kiểm tra trên nhiều màn hình**: Dùng Preview trong Android Studio để test nhiều kích thước.
