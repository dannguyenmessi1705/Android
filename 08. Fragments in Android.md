# Fragments in Android

Tài liệu này giới thiệu về Fragment trong Android và cách sử dụng cơ bản cho người mới bắt đầu.

## 1. What are Fragments?

**Fragment** là một thành phần giao diện (UI) có vòng đời riêng, có thể gắn vào một `Activity`. Bạn có thể hiểu Fragment như một “mảnh” giao diện và logic ứng dụng. Một Activity có thể chứa một hoặc nhiều Fragment.

**Đặc điểm chính**:
- Fragment có **layout riêng** và **logic riêng**.
- Fragment **phụ thuộc vào Activity** để hiển thị.
- Có thể **tái sử dụng** Fragment ở nhiều Activity khác nhau.
- Dễ tạo UI linh hoạt (đặc biệt khi làm ứng dụng đa màn hình).

**Ví dụ**: Màn hình có danh sách bên trái và chi tiết bên phải. Trên điện thoại có thể hiển thị 1 Fragment, trên tablet hiển thị 2 Fragment cùng lúc.

---

## 2. Creating Fragments

### 2.1. Tạo Fragment class

Ví dụ tạo Fragment mới:

```kotlin
class ExampleFragment : Fragment(R.layout.fragment_example) {

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        // Xử lý UI trong fragment
    }
}
```

### 2.2. Tạo layout XML cho Fragment

Tạo file `fragment_example.xml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello Fragment" />

</LinearLayout>
```

---

## 3. FrameLayout

`FrameLayout` thường được dùng làm **vùng chứa (container)** để đặt Fragment vào.

Ví dụ layout `activity_main.xml`:

```xml
<FrameLayout
    android:id="@+id/fragment_container"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

Ở đây `fragment_container` là ID để gắn Fragment vào.

---

## 4. Fragments Transaction

Fragment được thêm, thay thế hoặc xóa thông qua **FragmentTransaction**.

Ví dụ thêm Fragment:

```kotlin
val fragment = ExampleFragment()

supportFragmentManager.beginTransaction()
    .add(R.id.fragment_container, fragment)
    .commit()
```

Ví dụ thay thế Fragment:

```kotlin
supportFragmentManager.beginTransaction()
    .replace(R.id.fragment_container, fragment)
    .addToBackStack(null)
    .commit()
```

**Giải thích**:
- `.add()` : thêm Fragment vào container.
- `.replace()` : thay Fragment hiện tại bằng Fragment mới.
- `.addToBackStack(null)` : cho phép quay lại Fragment trước đó khi nhấn nút Back.
- `.commit()` : thực thi giao dịch.

### 4.1. Sơ đồ Back Stack (addToBackStack)

```text
Trạng thái ban đầu:
[Container] -> Fragment A

Thay thế và addToBackStack:
Transaction: replace A bằng B + addToBackStack

Back Stack:
top -> A

UI hiện tại:
[Container] -> Fragment B

Nhấn Back:
Pop back stack -> khôi phục Fragment A
```

### 4.2. Sơ đồ commit() và commitAllowingStateLoss()

```text
commit()
- An toàn: không cho phép commit khi state đã được lưu (sau onSaveInstanceState)
- Nếu cố commit muộn, có thể gây IllegalStateException

commitAllowingStateLoss()
- Vẫn cho phép commit sau khi state đã được lưu
- Có thể mất trạng thái Fragment khi hệ thống khôi phục
```

---

## 5. Fragments LifeCycle

Fragment có vòng đời riêng, tương tự Activity nhưng có thêm các bước gắn vào Activity.

**Các callback quan trọng**:

1. **onAttach()**: Fragment được gắn vào Activity.
2. **onCreate()**: Fragment được tạo.
3. **onCreateView()**: Tạo giao diện cho Fragment.
4. **onViewCreated()**: View đã sẵn sàng.
5. **onStart()**: Fragment bắt đầu hiển thị.
6. **onResume()**: Fragment hoạt động và tương tác được.
7. **onPause()**: Fragment tạm dừng.
8. **onStop()**: Fragment không còn hiển thị.
9. **onDestroyView()**: Hủy View của Fragment.
10. **onDestroy()**: Fragment bị hủy.
11. **onDetach()**: Fragment tách khỏi Activity.

### 5.1. Sơ đồ vòng đời (tổng quan)

```text
onAttach
  |
onCreate
  |
onCreateView
  |
onViewCreated
  |
onStart
  |
onResume
  |
onPause
  |
onStop
  |
onDestroyView
  |
onDestroy
  |
onDetach
```

---

## 6. Fragments LifeCycle App

Sự liên kết giữa vòng đời Activity và Fragment:

- Khi Activity **onCreate()** → Fragment **onAttach()**, **onCreate()**, **onCreateView()**.
- Khi Activity **onStart()** → Fragment **onStart()**.
- Khi Activity **onResume()** → Fragment **onResume()**.
- Khi Activity **onPause()** → Fragment **onPause()**.
- Khi Activity **onStop()** → Fragment **onStop()**.
- Khi Activity **onDestroy()** → Fragment **onDestroyView()**, **onDestroy()**, **onDetach()**.

### 6.1. Sơ đồ liên kết Activity - Fragment

```text
Activity : onCreate -> onStart -> onResume -> onPause -> onStop -> onDestroy
Fragment : onAttach -> onCreate -> onCreateView -> onViewCreated -> onStart -> onResume
           -> onPause -> onStop -> onDestroyView -> onDestroy -> onDetach
```

**Lưu ý quan trọng**:
- Nếu Fragment được thay thế nhưng `addToBackStack()` được gọi, thì Fragment chỉ bị **hủy View**, không bị hủy hoàn toàn. Khi quay lại, nó sẽ tạo lại View.
- Fragment nên xử lý dữ liệu trong **onCreate()** hoặc **onViewCreated()**, và giải phóng tài nguyên trong **onDestroyView()**.

---

## 7. Tổng kết

- Fragment giúp chia nhỏ giao diện và tái sử dụng dễ dàng.
- Dùng `FrameLayout` làm container để đặt Fragment.
- Thao tác với Fragment qua `FragmentTransaction`.
- Hiểu vòng đời Fragment giúp quản lý UI và dữ liệu tốt hơn.

Tài liệu này phù hợp cho người mới bắt đầu và có thể mở rộng thêm các kiến thức nâng cao về Fragment sau này.
